"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[8579],{8579:(I,u,d)=>{d.r(u),d.d(u,{ResetPasswordPageModule:()=>F});var p=d(177),i=d(4341),m=d(4742),P=d(4964),g=d(467),e=d(3953),h=d(2872),v=d(7935),_=d(1182),w=d(6340);let C=(()=>{var n;class c{constructor(t,o){this.afAuth=t,this.firestore=o}sendResetPasswordEmail(t){var o=this;return(0,g.A)(function*(){const r=Math.floor(1e5+9e5*Math.random()).toString(),s={code:r,createdAt:v.A.firestore.FieldValue.serverTimestamp(),used:!1};yield o.firestore.collection("passwordResetRequests").doc(t).set(s);const l={url:`http://localhost:8100/reset-password?email=${t}&code=${r}`,handleCodeInApp:!0};yield o.afAuth.sendPasswordResetEmail(t,l)})()}verifyResetCode(t,o){var r=this;return(0,g.A)(function*(){const s=yield r.firestore.collection("passwordResetRequests").doc(t).get().toPromise();if(null!=s&&s.exists){const l=s.data();if(l.code===o&&!l.used){if(l.createdAt instanceof v.A.firestore.Timestamp){const f=l.createdAt.toMillis()+36e5;if(Date.now()>f)return!1}return!0}}return!1})()}resetPassword(t,o,r){var s=this;return(0,g.A)(function*(){if(!(yield s.verifyResetCode(t,r)))throw new Error("C\xf3digo de verificaci\xf3n inv\xe1lido");try{const f=yield s.afAuth.currentUser;yield null==f?void 0:f.updatePassword(o),yield s.firestore.collection("passwordResetRequests").doc(t).update({used:!0})}catch(f){throw console.error("Error al restablecer la contrase\xf1a",f),f}})()}}return(n=c).\u0275fac=function(t){return new(t||n)(e.KVO(_.DS),e.KVO(w.Qe))},n.\u0275prov=e.jDH({token:n,factory:n.\u0275fac,providedIn:"root"}),c})();function b(n,c){1&n&&(e.j41(0,"small"),e.EFF(1,"El correo electr\xf3nico es obligatorio."),e.k0s())}function x(n,c){1&n&&(e.j41(0,"small"),e.EFF(1,"Ingrese un correo electr\xf3nico v\xe1lido."),e.k0s())}function M(n,c){if(1&n&&(e.j41(0,"div",18),e.nrm(1,"ion-icon",19),e.DNE(2,b,2,0,"small",20)(3,x,2,0,"small",20),e.k0s()),2&n){let a,t;const o=e.XpG(2);e.R7$(2),e.Y8G("ngIf",null==(a=o.resetPasswordForm.get("email"))||null==a.errors?null:a.errors.required),e.R7$(),e.Y8G("ngIf",null==(t=o.resetPasswordForm.get("email"))||null==t.errors?null:t.errors.email)}}function k(n,c){if(1&n){const a=e.RV6();e.j41(0,"form",10),e.bIt("ngSubmit",function(){e.eBV(a);const o=e.XpG();return e.Njj(o.resetPassword())}),e.j41(1,"ion-item",11),e.nrm(2,"ion-icon",12),e.j41(3,"ion-label",13),e.EFF(4,"Correo Electr\xf3nico"),e.k0s(),e.nrm(5,"ion-input",14),e.k0s(),e.DNE(6,M,4,2,"div",15),e.j41(7,"ion-button",16),e.nrm(8,"ion-icon",17),e.EFF(9," Enviar C\xf3digo "),e.k0s()()}if(2&n){let a;const t=e.XpG();e.Y8G("formGroup",t.resetPasswordForm),e.R7$(6),e.Y8G("ngIf",(null==(a=t.resetPasswordForm.get("email"))?null:a.invalid)&&(null==(a=t.resetPasswordForm.get("email"))?null:a.touched)),e.R7$(),e.Y8G("disabled",t.resetPasswordForm.invalid)}}function O(n,c){1&n&&(e.j41(0,"div",21),e.nrm(1,"ion-icon",22),e.j41(2,"h2"),e.EFF(3,"C\xf3digo Enviado"),e.k0s(),e.j41(4,"p"),e.EFF(5,"Se ha enviado un c\xf3digo de verificaci\xf3n a tu correo electr\xf3nico. Por favor, revisa tu bandeja de entrada."),e.k0s()())}const R=[{path:"",component:(()=>{var n;class c{constructor(t,o,r,s){this.formBuilder=t,this.navCtrl=o,this.authService=r,this.toastController=s,this.codeSent=!1,this.resetPasswordForm=this.formBuilder.group({email:["",[i.k0.required,i.k0.email]]}),this.verificationForm=this.formBuilder.group({code:["",[i.k0.required,i.k0.minLength(6),i.k0.maxLength(6)]],newPassword:["",[i.k0.required,i.k0.minLength(6)]],confirmPassword:["",[i.k0.required]]},{validator:this.checkPasswords})}checkPasswords(t){var o,r;return(null===(o=t.get("newPassword"))||void 0===o?void 0:o.value)===(null===(r=t.get("confirmPassword"))||void 0===r?void 0:r.value)?null:{notSame:!0}}resetPassword(){var t=this;return(0,g.A)(function*(){if(t.resetPasswordForm.valid){var o;const r=null===(o=t.resetPasswordForm.get("email"))||void 0===o?void 0:o.value;try{yield t.authService.sendResetPasswordEmail(r),t.codeSent=!0}catch{t.presentToast("Error al enviar el correo. Por favor, intenta de nuevo.")}}})()}verifyCodeAndResetPassword(){var t=this;return(0,g.A)(function*(){if(t.verificationForm.valid){var o,r;const l=null===(o=t.verificationForm.get("code"))||void 0===o?void 0:o.value,f=null===(r=t.verificationForm.get("newPassword"))||void 0===r?void 0:r.value;try{var s;yield t.authService.resetPassword(null===(s=t.resetPasswordForm.get("email"))||void 0===s?void 0:s.value,f,l),t.presentToast("Tu contrase\xf1a ha sido restablecida con \xe9xito."),t.navCtrl.navigateRoot("/login")}catch{t.presentToast("Error al restablecer la contrase\xf1a. Por favor, intenta de nuevo.")}}})()}goBackToLogin(){this.navCtrl.navigateBack("/login")}presentToast(t){var o=this;return(0,g.A)(function*(){(yield o.toastController.create({message:t,duration:2e3,position:"bottom"})).present()})()}}return(n=c).\u0275fac=function(t){return new(t||n)(e.rXU(i.ok),e.rXU(h.q9),e.rXU(C),e.rXU(m.K_))},n.\u0275cmp=e.VBU({type:n,selectors:[["app-reset-password"]],decls:12,vars:2,consts:[[1,"ion-padding"],[1,"reset-password-container","animated","fadeIn"],[1,"logo-container"],[1,"logo-frame"],["src","/assets/img/logo.png","alt","Logo",1,"logo"],[1,"reset-password-title","animated","fadeInDown"],[3,"formGroup","ngSubmit",4,"ngIf"],["class","confirmation-message animated fadeInUp",4,"ngIf"],["expand","block",1,"back-button","animated","bounceIn",3,"click"],["name","arrow-back-outline","slot","start"],[3,"ngSubmit","formGroup"],["lines","none",1,"custom-input","animated","fadeInUp"],["name","mail-outline","slot","start"],["position","floating"],["type","email","formControlName","email"],["class","error-message animated shake",4,"ngIf"],["expand","block","type","submit",1,"reset-password-button","animated","pulse",3,"disabled"],["name","send-outline","slot","start"],[1,"error-message","animated","shake"],["name","alert-circle-outline"],[4,"ngIf"],[1,"confirmation-message","animated","fadeInUp"],["name","checkmark-circle-outline",1,"success-icon"]],template:function(t,o){1&t&&(e.j41(0,"ion-content",0)(1,"div",1)(2,"div",2)(3,"div",3),e.nrm(4,"img",4),e.k0s()(),e.j41(5,"h1",5),e.EFF(6,"Recuperar Contrase\xf1a"),e.k0s(),e.DNE(7,k,10,3,"form",6)(8,O,6,0,"div",7),e.j41(9,"ion-button",8),e.bIt("click",function(){return o.goBackToLogin()}),e.nrm(10,"ion-icon",9),e.EFF(11," Regresar al Login "),e.k0s()()()),2&t&&(e.R7$(7),e.Y8G("ngIf",!o.codeSent),e.R7$(),e.Y8G("ngIf",o.codeSent))},dependencies:[p.bT,i.qT,i.BC,i.cb,i.j4,i.JD,m.Jm,m.W9,m.iq,m.$w,m.uz,m.he,m.Gw],styles:['@charset "UTF-8";ion-content[_ngcontent-%COMP%]{--background: linear-gradient(135deg, #667eea 0%, #764ba2 100%)}.reset-password-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;justify-content:center;align-items:center;height:100%;padding:20px;animation:_ngcontent-%COMP%_fadeIn 1s ease-in-out}.logo-container[_ngcontent-%COMP%]{margin-bottom:40px;perspective:1000px;width:150px;height:150px}.logo-frame[_ngcontent-%COMP%]{width:100%;height:100%;background:#ffffff26;border-radius:50%;display:flex;justify-content:center;align-items:center;box-shadow:0 8px 32px #1f26875e;-webkit-backdrop-filter:blur(8px);backdrop-filter:blur(8px);border:2px solid rgba(255,255,255,.3);transition:all .3s ease;animation:_ngcontent-%COMP%_float 6s ease-in-out infinite}.logo[_ngcontent-%COMP%]{width:75%;height:auto;object-fit:contain;filter:drop-shadow(0 4px 6px rgba(0,0,0,.2));transition:transform .3s ease}.logo-frame[_ngcontent-%COMP%]:hover{transform:scale(1.05) rotateY(10deg);box-shadow:0 15px 35px #1f268780}@keyframes _ngcontent-%COMP%_float{0%,to{transform:translateY(0) rotate(0)}50%{transform:translateY(-10px) rotate(5deg)}}.reset-password-title[_ngcontent-%COMP%]{font-size:2.2rem;color:#fff;text-align:center;margin-bottom:30px;animation:_ngcontent-%COMP%_fadeInDown 1s ease;text-shadow:2px 2px 4px rgba(0,0,0,.1)}form[_ngcontent-%COMP%]{width:100%;max-width:400px}.custom-input[_ngcontent-%COMP%]{--background: rgba(255, 255, 255, .2);--color: #fff;--placeholder-color: rgba(255, 255, 255, .6);margin-bottom:20px;border-radius:12px;--padding-start: 16px;--padding-end: 16px}.custom-input[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{color:#fffc}.custom-input[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{color:#fffc;font-size:1.2rem;margin-right:12px}.error-message[_ngcontent-%COMP%]{color:#ffd740;font-size:.8rem;margin-top:-10px;margin-bottom:15px;display:flex;align-items:center;padding-left:16px}.error-message[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{margin-right:5px;font-size:1rem}.reset-password-button[_ngcontent-%COMP%], .back-button[_ngcontent-%COMP%]{--background: #ffffff;--background-activated: #f4f4f4;--background-focused: #f4f4f4;--color: #667eea;margin-top:20px;border-radius:12px;font-weight:600;letter-spacing:.5px;height:54px;font-size:18px;text-transform:none}.reset-password-button[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%], .back-button[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:1.2rem;margin-right:8px}.back-button[_ngcontent-%COMP%]{--background: rgba(255, 255, 255, .2);--background-activated: rgba(255, 255, 255, .3);--background-focused: rgba(255, 255, 255, .3);--color: #ffffff;margin-top:20px}@keyframes _ngcontent-%COMP%_fadeIn{0%{opacity:0}to{opacity:1}}@keyframes _ngcontent-%COMP%_fadeInDown{0%{opacity:0;transform:translateY(-20px)}to{opacity:1;transform:translateY(0)}}@keyframes _ngcontent-%COMP%_fadeInUp{0%{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}@keyframes _ngcontent-%COMP%_bounceIn{0%,20%,40%,60%,80%,to{transform:scale(1)}50%{transform:scale(1.1)}}@keyframes _ngcontent-%COMP%_pulse{0%,to{transform:scale(1)}50%{transform:scale(1.05)}}@keyframes _ngcontent-%COMP%_shake{0%,to{transform:translate(0)}10%,30%,50%,70%,90%{transform:translate(-5px)}20%,40%,60%,80%{transform:translate(5px)}}.animated[_ngcontent-%COMP%]{animation-duration:1s;animation-fill-mode:both}.fadeIn[_ngcontent-%COMP%]{animation-name:_ngcontent-%COMP%_fadeIn}.fadeInDown[_ngcontent-%COMP%]{animation-name:_ngcontent-%COMP%_fadeInDown}.fadeInUp[_ngcontent-%COMP%]{animation-name:_ngcontent-%COMP%_fadeInUp}.bounceIn[_ngcontent-%COMP%]{animation-name:_ngcontent-%COMP%_bounceIn}.pulse[_ngcontent-%COMP%]{animation-name:_ngcontent-%COMP%_pulse;animation-iteration-count:infinite;animation-duration:2s}.shake[_ngcontent-%COMP%]{animation-name:_ngcontent-%COMP%_shake}.confirmation-message[_ngcontent-%COMP%]{text-align:center;margin-top:20px;padding:20px;background:#ffffff1a;border-radius:10px}.confirmation-message[_ngcontent-%COMP%]   .success-icon[_ngcontent-%COMP%]{font-size:64px;color:#2dd36f;margin-bottom:20px}.confirmation-message[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:24px;color:#fff;margin-bottom:10px}.confirmation-message[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:16px;color:#d7d8da}']}),c})()}];let y=(()=>{var n;class c{}return(n=c).\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.$C({type:n}),n.\u0275inj=e.G2t({imports:[P.iI.forChild(R),P.iI]}),c})(),F=(()=>{var n;class c{}return(n=c).\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.$C({type:n}),n.\u0275inj=e.G2t({imports:[p.MD,i.YN,i.X1,m.bv,y]}),c})()}}]);